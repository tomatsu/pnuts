<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>pnuts.lib module</title>
    <META Http-Equiv="Content-Style-Type" Content="text/css">
    <LINK Type="text/css" Rel="stylesheet" Href="../../stylesheet.css">
  </head>

  <body>

<div class="nav"><a href="../../../doc/guide.html">Pnuts User's
Guide</a> -> <a href="index.html"><tt>pnuts.lib</tt></a> -> Compiling Scripts in Pnuts</div>

    <h2>Compiling Scripts in Pnuts</h2>

<a name=compile></a>
<h3><tt>compile()</tt></h3>

<p>
This function is used to speed scripts when <a href="pnuts_engine.html">the pure interpreter</a> is used as the runtime engine.
</p>

<div class="box">
<div class="synopsis"><b>compile</b><tt>(<a
href="http://java.sun.com/j2se/1.4/docs/api/java/io/InputStream.html">InputStream</a>
</tt><em>input</em><tt>)</tt> or</div>
<div class="synopsis2"><tt>(<a href="http://java.sun.com/j2se/1.4/docs/api/java/io/Reader.html">Reader</a> </tt><em>input</em><tt>)</tt> or</div>
<div class="synopsis2"><tt>(<a href="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html">String</a> </tt><em>expression</em><tt>)</tt> or</div>
<div class="synopsis2"><tt>(<a href="http://java.sun.com/j2se/1.4/docs/api/java/io/File.html">File</a> </tt><em>file</em> { , boolean <em>recompileIfUpdated</em> } <tt>)</tt> or</div>
<div class="synopsis2"><tt>(<a href="http://java.sun.com/j2se/1.4/docs/api/java/net/URL.html">URL</a> </tt><em>url</em> { , boolean <em>recompileIfUpdated</em> } <tt>)</tt> or</div>
<div class="synopsis2"><tt>(<a href="../../../apidoc/pnuts/lang/Pnuts.html">Pnuts</a> </tt><em>parsedExpression</em><tt>)</tt></div>
</div>

<p>
<tt>compile(</tt><em></em><tt>)</tt> function compiles the specified
script and returns a <a href="../../../apidoc/pnuts/lang/Executable.html"><tt>pnuts.lang.Executable</tt></a> object.
To execute the returned object, call <a href="#run"><tt>run()</tt></a> function or <a href="../../../apidoc/pnuts/lang/Executable.html#run(pnuts.lang.Context)"><tt>run(pnuts.lang.Context)</a></tt> method.
</p>

<div class="eg">e.g.
<pre>
code1 = compile(open("/tmp/test.pnut"))
run(code1)

code2 = compile("1 + 2")
run(code2)
</pre>
</div>
<p>
When File or URL is specified, an optional argument <em>recompileIfUpdated</em> can be specified.
If <em>recompileIfUpdated</em> is true, the script is recompiled if it has been updated since last compiled.
</p>

<p>
<tt>compile(</tt><em>parsedExpression</em>) takes a Pnuts object which can be obtained by <a href="compile.html#parse"><tt>parse()</tt></a> function.
</p>

<p>
When the input is too large, or such case that generated bytecode exceeds the JVM limitation, <tt>compile()</tt> returns an executable <a href="../../../apidoc/pnuts/lang/Pnuts.html">pnuts.lang.Pnuts</a> object which is not compiled.
</p>

<div class="box">
<div class="synopsis"><b>compile</b><tt>(<a href="../../../apidoc/pnuts/lang/PnutsFunction.html">PnutsFunction</a> </tt><em>function</em><tt>)</tt></div>
</div>

<p>
<tt>compile(</tt><em>function</em><tt>)</tt> function compiles the
specified function to optimize its execution speed.
</p>

<div class="eg">e.g.
<pre>
function func (x) x + 1
compile(func)
</pre>
</div>

<div class="box">
<div class="synopsis"><b>compile</b><tt>(<a href="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html">String</a> </tt><em>source</em> <tt>, <a href="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html">String</a> </tt><em>className</em> <tt>, <a href="http://java.sun.com/j2se/1.4/docs/api/java/io/File.html">File</a> </tt><em>dest</em><tt>) </tt> or </div>
<div class="synopsis2"><tt>(<a href="../../../apidoc/pnuts/lang/Pnuts.html">Pnuts</a> </tt><em>source</em> <tt>, <a href="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html">String</a> </tt><em>className</em> <tt>, <a href="http://java.sun.com/j2se/1.4/docs/api/java/io/File.html">File</a> </tt><em>dest</em><tt>)</tt> or </div>
<div class="synopsis2"><tt>(<a href="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html">String</a> </tt><em>source</em> <tt>, <a href="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html">String</a> </tt><em>className</em> <tt>, <a href="http://java.sun.com/j2se/1.4/docs/api/java/util/zip/ZipOutputStream.html">ZipOutputStream</a> </tt><em>dest</em><tt>)</tt> or </div>
<div class="synopsis2"><tt>(<a href="../../../apidoc/pnuts/lang/Pnuts.html">Pnuts</a> </tt><em>source</em> <tt>, <a href="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html">String</a> </tt><em>classNname</em> <tt>, <a href="http://java.sun.com/j2se/1.4/docs/api/java/util/zip/ZipOutputStream.html">ZipOutputStream</a> </tt><em>dest</em><tt>)</tt></div>
</div>
<p>
When <em>source</em> is a String or a Pnuts object (a parsed expression), it is compiled into a class <em>className</em>.
When <em>source</em> is a function, it is also compiled into a class <em>className</em>.
</p>
<p>
When <em>dest</em> is a String or a <a href="http://java.sun.com/j2se/1.4/docs/api/java/io/File.html">java.io.File</a> object, the compiled files are saved in the directory.
When <em>dest</em> is a <a href="http://java.sun.com/j2se/1.4/docs/api/java/util/zip/ZipOutputStream.html">java.util.zip.ZipOutputStream</a> object, the compiled files are added to the ZIP archive.
</p>

<a name="isCompiled"></a>
<div class="box">
<div class="synopsis"><b>isCompiled</b><tt>(<a href="http://java.sun.com/j2se/1.4/docs/api/java/lang/Object.html">Object</a> </tt><em>object</em><tt>)</tt></div>
</div>

<p>
<tt>isCompiled()</tt> checks if the specified <em>object</em> is compiled.
</p>

<div class="eg">e.g.
<pre>
p = parse("function f() 100")
isCompiled(p) ==> false

p = compile(p)
isCompiled(p) ==> true

f = run(p)
isCompiled(f) ==> false

compile(f)
isCompiled(f) ==> true
</pre>
</div>

<a name="parse"></a>
<div class="box">
<div class="synopsis"><b>parse</b><tt> ( <a href="http://java.sun.com/j2se/1.4/docs/api/java/lang/String.html">String</a> </tt><em>expression</em><tt> ) </tt> or</div>
<div class="synopsis2"><tt> ( <a href="http://java.sun.com/j2se/1.4/docs/api/java/io/InputStream.html">InputStream</a> </tt><em>input</em><tt> ) or</tt></div>
<div class="synopsis2"><tt> ( <a
href="http://java.sun.com/j2se/1.4/docs/api/java/io/Reader.html">Reader</a>
</tt><em>input</em><tt> ) or</tt></div>
<div class="synopsis2"><tt> ( <a href="http://java.sun.com/j2se/1.4/docs/api/java/io/File.html">File</a>
</tt><em>file</em><tt> )</tt> or</div>
<div class="synopsis2"><tt> ( <a href="http://java.sun.com/j2se/1.4/docs/api/java/net/URL.html">URL</a> </tt><em>url</em><tt> )</tt></div>
</div>

<p>
<tt>parse()</tt> parses a script and returns a <a
href="../../../apidoc/pnuts/lang/Pnuts.html"><tt>pnuts.lang.Pnuts</tt></a>
object, which can be executed later with <a href="#run"><tt>run()</tt></a> function.  When an error occurs during the parsing, <a href="../../../apidoc/pnuts/lang/ParseException.html">ParseException</a> is thrown.  
</p>

<a name="unparse"></a>
<div class="box">
<div class="synopsis"><b>unparse</b><tt> ( <a href="../../../apidoc/pnuts/lang/Pnuts.html">pnuts.lang.Pnuts</a> <em>parsedExpression</em> ) </tt></div>
</div>
<p>
<tt>unparse()</tt> un-parse the specified parsed expression and returns a String representation of the original expression.
</p>

<a name="run"></a>
<div class="box">
<div class="synopsis"><b>run</b><tt> ( <a href="../../../apidoc/pnuts/lang/Executable.html">Executable</a> </tt><em>executable</em><tt> ) </tt></div>
</div>
<p>
<tt>run()</tt> executes an <a href="../../../apidoc/pnuts/lang/Executable.html">Executable</a>
object which is created by <tt>parse()</tt> or <tt>compile()</tt> call, and returns the result of the execution.
</p>

<div class="nav2"><a href="../../../doc/guide.html">Pnuts User's
Guide</a> -> <a href="index.html"><tt>pnuts.lib</tt></a> -> Compiling Scripts in Pnuts</div>
  </body>
</html>
